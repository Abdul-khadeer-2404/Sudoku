<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A modern, responsive Sudoku game with multiple difficulty levels and features">
    <meta name="theme-color" content="#4A90E2">
    <title>Modern Sudoku</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="responsive.css">
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
</head>
<body>
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading Sudoku...</p>
    </div>

    <div class="container" role="main">
        <header class="header">
            <h1 class="title">Modern Sudoku</h1>
            <div class="controls" role="toolbar" aria-label="Game controls">
                <div class="control-group">
                    <div class="timer-section" aria-live="polite">
                        <span class="timer-label">Time:</span>
                        <span id="timer" class="timer-display" aria-label="Current game time">00:00</span>
                    </div>
                    <button id="dark-mode-toggle" class="control-btn dark-toggle" aria-label="Toggle dark mode">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
                
                <div class="control-group">
                    <select id="difficulty-select" class="control-select" aria-label="Select difficulty level">
                        <option value="easy">Easy</option>
                        <option value="medium" selected>Medium</option>
                        <option value="hard">Hard</option>
                        <option value="expert">Expert</option>
                    </select>
                    
                    <button id="new-game-btn" class="control-btn primary" aria-label="Start new game">New Game</button>
                    <button id="hint-btn" class="control-btn secondary" aria-label="Get a hint">Hint</button>
                    <button id="reset-btn" class="control-btn secondary" aria-label="Reset current game">Reset</button>
                </div>
            </div>
        </header>

        <main class="game-area">
            <div class="sudoku-container">
                <div id="sudoku-grid" class="sudoku-grid" role="grid" aria-label="Sudoku puzzle">
                    <!-- Grid cells will be generated by JavaScript -->
                </div>
            </div>
            
            <div class="game-info" role="status" aria-live="polite">
                <div class="info-item">
                    <span class="info-label">Difficulty:</span>
                    <span id="current-difficulty" class="info-value">Medium</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Hints Used:</span>
                    <span id="hints-count" class="info-value">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Mistakes:</span>
                    <span id="mistakes-count" class="info-value">0</span>
                </div>
            </div>
        </main>

        <div id="victory-modal" class="modal hidden" role="dialog" aria-labelledby="victory-title" aria-modal="true">
            <div class="modal-content">
                <h2 id="victory-title"><i class="fas fa-trophy"></i> Congratulations!</h2>
                <p>You solved the puzzle!</p>
                <p>Time: <span id="final-time"></span></p>
                <p>Hints used: <span id="final-hints"></span></p>
                <button id="play-again-btn" class="control-btn primary" aria-label="Play another game">Play Again</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Show loading overlay
        const loadingOverlay = document.getElementById('loading-overlay');
        const errorMessage = document.createElement('p');
        errorMessage.className = 'error-message';
        errorMessage.style.display = 'none';
        loadingOverlay.appendChild(errorMessage);

        // Function to show error
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            loadingOverlay.querySelector('.loading-spinner').style.display = 'none';
        }

        // Function to hide loading overlay
        function hideLoading() {
            loadingOverlay.style.opacity = '0';
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 300);
        }

        // Load modules with timeout
        const loadModule = async (path, timeout = 5000) => {
            try {
                const module = await Promise.race([
                    import(path),
                    new Promise((_, reject) => 
                        setTimeout(() => reject(new Error(`Timeout loading ${path}`)), timeout)
                    )
                ]);
                return module;
            } catch (error) {
                console.error(`Error loading ${path}:`, error);
                throw error;
            }
        };

        // Load all modules
        async function initializeGame() {
            try {
                console.log('Loading modules...');
                const modules = await Promise.all([
                    loadModule('./sudoku.js'),
                    loadModule('./timer.js'),
                    loadModule('./difficulty.js'), 
                    loadModule('./hints.js'),
                    loadModule('./script.js')
                ]);

                console.log('All modules loaded successfully');

                // Initialize game after all modules are loaded
                if (modules[4].default) {
                    new modules[4].default();
                } else {
                    new modules[4].SudokuGame();
                }

                hideLoading();
            } catch (error) {
                console.error('Failed to initialize game:', error);
                showError('Failed to load the game. Please refresh the page.');
            }
        }

        // Start loading
        initializeGame();
    </script>
</body>
</html>